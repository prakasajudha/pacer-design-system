@namespace Pertamina.DesignSystem.Blazor
@inherits ComponentBase

<button 
    type="@Type"
    class="@GetButtonClasses()"
    disabled="@(Disabled || Loading)"
    @onclick="OnClick"
    @attributes="AdditionalAttributes">
    
    @if (Loading)
    {
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    }
    
    @if (!Loading && LeftIcon != null)
    {
        <span class="shrink-0">@LeftIcon</span>
    }
    
    @if (ChildContent != null)
    {
        <span class="px-1">@ChildContent</span>
    }
    
    @if (!Loading && RightIcon != null)
    {
        <span class="shrink-0">@RightIcon</span>
    }
</button>

@code {
    /// <summary>
    /// Button variant (visual style)
    /// </summary>
    [Parameter]
    public ButtonVariant Variant { get; set; } = ButtonVariant.Solid;

    /// <summary>
    /// Button size
    /// </summary>
    [Parameter]
    public ButtonSize Size { get; set; } = ButtonSize.Medium;

    /// <summary>
    /// Loading state
    /// </summary>
    [Parameter]
    public bool Loading { get; set; } = false;

    /// <summary>
    /// Color button (Primary (default) / Danger)
    /// </summary>
    [Parameter]
    public string Color { get; set; } = "primary"; // primary | danger

    /// <summary>
    /// Selected/toggled state
    /// </summary>
    [Parameter]
    public bool Selected { get; set; } = false;

    /// <summary>
    /// Icon sebelum label tombol
    /// </summary>
    [Parameter]
    public RenderFragment? LeftIcon { get; set; }

    /// <summary>
    /// Icon setelah label tombol
    /// </summary>
    [Parameter]
    public RenderFragment? RightIcon { get; set; }

    /// <summary>
    /// Disabled state
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; } = false;

    /// <summary>
    /// Native HTML button type
    /// </summary>
    [Parameter]
    public string Type { get; set; } = "button";

    /// <summary>
    /// Button content
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Click event callback
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    /// <summary>
    /// Additional HTML attributes
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string GetButtonClasses()
    {
        var classes = new List<string>
        {
            "inline-flex",
            "items-center",
            "justify-center",
            "font-medium",
            "text-sm",
            "leading-6",
            "transition-colors",
            "select-none",
            "disabled:pointer-events-none",
            "disabled:opacity-50",
        };

        // Link variants are special in Figma (24px height, no padding/bg).
        if (Variant is ButtonVariant.LinkPrimary or ButtonVariant.LinkSecondary)
        {
            classes.Add("h-6");
            classes.Add("px-0");
            classes.Add("py-0");
            classes.Add("rounded-none");
            classes.Add("underline-offset-4");
            classes.Add("hover:underline");
            classes.Add("focus-visible:outline-none");
            classes.Add("focus-visible:ring-2");
            classes.Add("focus-visible:ring-offset-2");
            classes.Add("focus-visible:ring-offset-white");

            if (Color == "danger")
            {
                classes.Add("text-red-600");
                classes.Add("hover:text-red-700");
                classes.Add("hover:underline");
                classes.Add("focus-visible:ring-red-200");
                if (Selected) classes.Add("underline");
                return string.Join(" ", classes);
            }

            if (Variant == ButtonVariant.LinkPrimary)
            {
                classes.Add("text-brand-300");
                classes.Add("focus-visible:ring-brand-200");
                if (Selected) classes.Add("underline");
                return string.Join(" ", classes);
            }

            classes.Add("text-slate-900");
            classes.Add("focus-visible:ring-slate-200");
            if (Selected) classes.Add("underline");
            return string.Join(" ", classes);
        }

        // Size styles (md/sm) - menggunakan theme values untuk menghindari arbitrary values (SAST/DAST safe)
        classes.Add(Size switch
        {
            ButtonSize.Small => "min-w-button-sm py-1.5 px-2 gap-0 rounded-button",
            _ => "min-w-button-md py-2 px-3 gap-1 rounded-button",
        });

        // Helper untuk double ring focus effect
        // Menggunakan utility classes dari theme untuk menghindari arbitrary shadow values
        string GetFocusRing(string ringColor)
        {
            return ringColor switch
            {
                "brand-300" => "focus-ring-primary",
                "slate-200" => "focus-ring-slate",
                "red-200" => "focus-ring-danger",
                _ => "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-white"
            };
        }

        // Variant styles (non-link)
        if (Color == "danger")
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Secondary => $"bg-white text-red-600 border border-red-600 hover:bg-red-50 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                ButtonVariant.Outline => $"bg-white text-red-600 border border-red-600 hover:bg-red-50 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                ButtonVariant.Ghost => $"bg-transparent text-red-600 hover:bg-red-50 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                _ => $"bg-red-600 text-white hover:bg-red-700 {GetFocusRing("red-200")}"
            });

            if (Selected)
            {
                classes.Add(Variant switch
                {
                    ButtonVariant.Secondary => "bg-red-50 text-red-700",
                    ButtonVariant.Outline => "bg-red-50 text-red-700",
                    ButtonVariant.Ghost => "bg-red-50 text-red-700",
                    _ => "bg-red-700",
                });
            }
        }
        else
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Solid => $"bg-brand-300 text-white hover:bg-brand-400 {GetFocusRing("brand-300")}",
                ButtonVariant.Secondary => $"bg-white text-brand-300 border border-brand-300 hover:bg-brand-50 hover:text-brand-400 {GetFocusRing("brand-300")} focus-visible:text-brand-400",
                ButtonVariant.Outline => $"bg-white text-slate-900 border border-slate-300 hover:bg-slate-50 {GetFocusRing("slate-200")}",
                ButtonVariant.Ghost => $"bg-transparent text-slate-900 hover:bg-slate-100 {GetFocusRing("slate-200")}",
                _ => $"bg-brand-300 text-white hover:bg-brand-400 {GetFocusRing("brand-300")}"
            });

            if (Selected)
            {
                classes.Add(Variant switch
                {
                    ButtonVariant.Solid => "bg-brand-400",
                    ButtonVariant.Secondary => "bg-brand-50 text-brand-500",
                    ButtonVariant.Outline => "bg-slate-100",
                    ButtonVariant.Ghost => "bg-slate-100",
                    _ => ""
                });
            }
        }

        return string.Join(" ", classes);
    }
}
