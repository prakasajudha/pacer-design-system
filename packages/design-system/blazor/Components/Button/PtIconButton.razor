@namespace Pertamina.DesignSystem.Blazor
@inherits ComponentBase

<button
    type="@Type"
    class="@GetButtonClasses()"
    disabled="@(Disabled || Loading)"
    aria-label="@AriaLabel"
    aria-pressed="@(Selected ? "true" : null)"
    @onclick="OnClick"
    @attributes="AdditionalAttributes">

    @if (Loading)
    {
        <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    }
    else
    {
        <span class="shrink-0 inline-flex items-center justify-center [&>svg]:h-4 [&>svg]:w-4" aria-hidden="true">
            @Icon
        </span>
    }
</button>

@code {
    /// <summary>
    /// Icon-only button wajib memiliki aria-label.
    /// </summary>
    [Parameter]
    public string AriaLabel { get; set; } = string.Empty;

    /// <summary>
    /// Icon content (mis. SVG).
    /// </summary>
    [Parameter]
    public RenderFragment? Icon { get; set; }

    /// <summary>
    /// Button variant (visual style)
    /// </summary>
    [Parameter]
    public ButtonVariant Variant { get; set; } = ButtonVariant.Solid;

    /// <summary>
    /// Icon button size (xss / xs / sm / md)
    /// </summary>
    [Parameter]
    public string Size { get; set; } = "md";

    /// <summary>
    /// Bentuk: square (tanpa radius) atau rounded (radius 6px)
    /// </summary>
    [Parameter]
    public string Shape { get; set; } = "square";

    /// <summary>
    /// Color button (primary / danger / success / warning / neutral) — mengikuti state warna Button
    /// </summary>
    [Parameter]
    public string Color { get; set; } = "primary";

    /// <summary>
    /// Selected/toggled state
    /// </summary>
    [Parameter]
    public bool Selected { get; set; } = false;

    /// <summary>
    /// Loading state
    /// </summary>
    [Parameter]
    public bool Loading { get; set; } = false;

    /// <summary>
    /// Disabled state
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; } = false;

    /// <summary>
    /// Button type attribute
    /// </summary>
    [Parameter]
    public string Type { get; set; } = "button";

    /// <summary>
    /// Click event callback
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    /// <summary>
    /// Additional HTML attributes
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string GetSizeClasses()
    {
        // Square = var(--radius) → rounded-button (6px); rounded = rounded-full (Figma PACER).
        var radius = Shape == "rounded" ? "rounded-full" : "rounded-button";
        return Size switch
        {
            "xss" => $"h-5 w-5 p-0.5 {radius}",
            "xs" => $"h-7 w-7 p-1.5 {radius}",
            "sm" => $"h-8 w-8 p-2 {radius}",
            _ => $"h-10 w-10 p-3 {radius}",
        };
    }

    private static string GetFocusRing(string ringColor)
    {
        return ringColor switch
        {
            "brand-300" => "focus-ring-primary",
            "slate-200" => "focus-ring-slate",
            "red-200" => "focus-ring-danger",
            "green-200" => "focus-ring-success",
            "amber-200" => "focus-ring-warning",
            _ => "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-white"
        };
    }

    private string GetButtonClasses()
    {
        var classes = new List<string>
        {
            "inline-flex",
            "items-center",
            "justify-center",
            "transition-colors",
            "select-none",
            "disabled:pointer-events-none",
            "disabled:opacity-50",
            "active:opacity-90",
            "disabled:active:opacity-50",
            GetSizeClasses(),
        };

        var isLinkVariant = Variant is ButtonVariant.LinkPrimary or ButtonVariant.LinkSecondary;

        if (Color == "danger")
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Secondary => $"bg-red-50 text-red-600 border border-red-600 hover:bg-red-100 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                ButtonVariant.Outline => $"text-red-600 border border-red-600 hover:bg-red-50 hover:text-red-700 hover:border-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700 focus-visible:border-red-700",
                ButtonVariant.Ghost => $"bg-transparent text-red-600 hover:bg-red-50 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                _ when isLinkVariant => $"bg-transparent text-red-600 hover:bg-red-50 hover:text-red-700 {GetFocusRing("red-200")} focus-visible:text-red-700",
                _ => $"bg-red-600 text-white hover:bg-red-700 {GetFocusRing("red-200")}"
            });
            if (Selected) classes.Add(Variant == ButtonVariant.Secondary ? "bg-red-200 text-red-800" : Variant == ButtonVariant.Outline ? "bg-red-100 text-red-800 border-red-800" : Variant == ButtonVariant.Ghost || isLinkVariant ? "bg-red-100 text-red-800" : "bg-red-800");
            return string.Join(" ", classes);
        }

        if (Color == "success")
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Solid => $"bg-green-600 text-white hover:bg-green-700 {GetFocusRing("green-200")}",
                ButtonVariant.Secondary => $"bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 {GetFocusRing("green-200")} focus-visible:text-green-700",
                ButtonVariant.Outline => $"text-green-600 border border-green-600 hover:bg-green-50 hover:text-green-700 hover:border-green-700 {GetFocusRing("green-200")} focus-visible:text-green-700 focus-visible:border-green-700",
                ButtonVariant.Ghost => $"bg-transparent text-green-600 hover:bg-green-50 hover:text-green-700 {GetFocusRing("green-200")} focus-visible:text-green-700",
                _ when isLinkVariant => $"bg-transparent text-green-600 hover:bg-green-50 hover:text-green-700 {GetFocusRing("green-200")} focus-visible:text-green-700",
                _ => $"bg-green-600 text-white hover:bg-green-700 {GetFocusRing("green-200")}"
            });
            if (Selected) classes.Add(Variant == ButtonVariant.Solid ? "bg-green-800" : Variant == ButtonVariant.Secondary ? "bg-green-200 text-green-800" : Variant == ButtonVariant.Outline ? "bg-green-100 text-green-800 border-green-800" : "bg-green-100 text-green-800");
            return string.Join(" ", classes);
        }

        if (Color == "warning")
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Solid => $"bg-amber-600 text-white hover:bg-amber-700 {GetFocusRing("amber-200")}",
                ButtonVariant.Secondary => $"bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 {GetFocusRing("amber-200")} focus-visible:text-amber-700",
                ButtonVariant.Outline => $"text-amber-600 border border-amber-600 hover:bg-amber-50 hover:text-amber-700 hover:border-amber-700 {GetFocusRing("amber-200")} focus-visible:text-amber-700 focus-visible:border-amber-700",
                ButtonVariant.Ghost => $"bg-transparent text-amber-600 hover:bg-amber-50 hover:text-amber-700 {GetFocusRing("amber-200")} focus-visible:text-amber-700",
                _ when isLinkVariant => $"bg-transparent text-amber-600 hover:bg-amber-50 hover:text-amber-700 {GetFocusRing("amber-200")} focus-visible:text-amber-700",
                _ => $"bg-amber-600 text-white hover:bg-amber-700 {GetFocusRing("amber-200")}"
            });
            if (Selected) classes.Add(Variant == ButtonVariant.Solid ? "bg-amber-800" : Variant == ButtonVariant.Secondary ? "bg-amber-200 text-amber-800" : Variant == ButtonVariant.Outline ? "bg-amber-100 text-amber-800 border-amber-800" : "bg-amber-100 text-amber-800");
            return string.Join(" ", classes);
        }

        if (Color == "neutral")
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Solid => $"bg-slate-600 text-white hover:bg-slate-700 {GetFocusRing("slate-200")}",
                ButtonVariant.Secondary => $"bg-slate-100 text-slate-600 hover:bg-slate-200 hover:text-slate-700 {GetFocusRing("slate-200")} focus-visible:text-slate-700",
                ButtonVariant.Outline => $"text-slate-600 border border-slate-600 hover:bg-slate-50 hover:text-slate-700 hover:border-slate-700 {GetFocusRing("slate-200")} focus-visible:text-slate-700 focus-visible:border-slate-700",
                ButtonVariant.Ghost => $"bg-transparent text-slate-600 hover:bg-slate-50 hover:text-slate-700 {GetFocusRing("slate-200")} focus-visible:text-slate-700",
                _ when isLinkVariant => $"bg-transparent text-slate-600 hover:bg-slate-50 hover:text-slate-700 {GetFocusRing("slate-200")} focus-visible:text-slate-700",
                _ => $"bg-slate-600 text-white hover:bg-slate-700 {GetFocusRing("slate-200")}"
            });
            if (Selected) classes.Add(Variant == ButtonVariant.Solid ? "bg-slate-800" : Variant == ButtonVariant.Secondary ? "bg-slate-300 text-slate-800" : Variant == ButtonVariant.Outline ? "bg-slate-100 text-slate-800 border-slate-800" : "bg-slate-100 text-slate-800");
            return string.Join(" ", classes);
        }

        // Primary
        classes.Add(Variant switch
        {
            ButtonVariant.Solid => $"bg-brand-300 text-white hover:bg-brand-400 {GetFocusRing("brand-300")}",
            ButtonVariant.Secondary => $"bg-brand-50 text-brand-600 hover:bg-brand-100 hover:text-brand-700 {GetFocusRing("brand-300")} focus-visible:text-brand-700",
            ButtonVariant.Outline => $"text-brand-600 border border-brand-600 hover:bg-brand-50 hover:text-brand-700 hover:border-brand-700 {GetFocusRing("brand-300")} focus-visible:text-brand-700 focus-visible:border-brand-700",
            ButtonVariant.Ghost => $"bg-transparent text-slate-900 hover:bg-slate-100 {GetFocusRing("slate-200")}",
            ButtonVariant.LinkPrimary => $"bg-transparent text-brand-300 hover:bg-brand-50 {GetFocusRing("brand-300")}",
            ButtonVariant.LinkSecondary => $"bg-transparent text-slate-900 hover:bg-slate-100 {GetFocusRing("slate-200")}",
            _ => $"bg-brand-300 text-white hover:bg-brand-400 {GetFocusRing("brand-300")}"
        });
        if (Selected)
        {
            classes.Add(Variant switch
            {
                ButtonVariant.Solid => "bg-brand-500",
                ButtonVariant.Secondary => "bg-brand-200 text-brand-800",
                ButtonVariant.Outline => "bg-brand-50 text-brand-700 border-brand-500",
                ButtonVariant.Ghost => "bg-brand-50 text-brand-700",
                ButtonVariant.LinkPrimary => "bg-brand-50",
                ButtonVariant.LinkSecondary => "bg-slate-100",
                _ => "bg-brand-500"
            });
        }
        return string.Join(" ", classes);
    }
}
